---
- hosts: repo
  gather_facts: yes
  become: yes
  tasks:
    - name: "NFS setup"
      include_role:
        name: nfs
      when: "setup_nfs"
      run_once: yes
      tags: nfs

- hosts: kube-cluster
  gather_facts: yes
  become: yes
  become_method: sudo
  roles:
    - { role: commons/pre-install, tags: pre-install }

# - hosts: kube-cluster
#   gather_facts: yes
#   become: yes
#   roles:
#     - { role: docker, tags: docker }

# - hosts: master
#   gather_facts: yes
#   become: yes
#   roles:
#     - { role: kubernetes/master, tags: master }
#     - { role: cni, tags: cni }

# - hosts: node
#   gather_facts: yes
#   become: yes
#   roles:
#     - { role: kubernetes/node, tags: node }

# - hosts: master
#   gather_facts: yes
#   become: yes
#   tasks:
#     - name: "Helm role"
#       include_role:
#         name: helm
#       when: "additional_features.helm"
#       run_once: yes
#       tags: helm

#     - name: "MetalLB role"
#       include_role:
#         name: metallb
#       when: "additional_features.metallb"
#       run_once: yes
#       tags: metallb

#     - name: "Healthcheck role"
#       include_role:
#         name: healthcheck
#       when: "additional_features.healthcheck"
#       run_once: yes
#       tags: healthcheck

